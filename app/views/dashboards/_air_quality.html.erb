<% if locations.any? %>
  <div class="row">
    <% locations.each do |location| %>
      <% air = location.latest_air_quality %>
      <% if air.present? %>
        <div class="col-md-6 mb-3">
          <div class="card border-success">
            <div class="card-body">
              <h6 class="card-title">
                <%= location.name %>
              </h6>
              <div class="mb-3">
                <% aqi_color = case air.aqi_level
                               when 1 then "success"
                               when 2 then "info"
                               when 3 then "warning"
                               when 4..5 then "danger"
                               end %>
                <span class="badge bg-<%= aqi_color %>">
                  AQI <%= air.aqi_level %> - <%= air.aqi_name %>
                </span>
              </div>
              <div class="row mt-3">
                <div class="col-6">
                  <small class="text-muted d-block">PM2.5</small>
                  <div class="h6 mb-0">
                    <%= air.pm2_5&.round(1) %> µg/m³
                  </div>
                </div>
                <div class="col-6">
                  <small class="text-muted d-block">PM10</small>
                  <div class="h6 mb-0">
                    <%= air.pm10&.round(1) %> µg/m³
                  </div>
                </div>
              </div>
              <div class="row mt-3">
                <div class="col-4">
                  <small class="text-muted d-block">O3</small>
                  <div class="h6 mb-0"><%= air.o3&.round(1) %></div>
                </div>
                <div class="col-4">
                  <small class="text-muted d-block">NO2</small>
                  <div class="h6 mb-0"><%= air.no2&.round(1) %></div>
                </div>
                <div class="col-4">
                  <small class="text-muted d-block">SO2</small>
                  <div class="h6 mb-0"><%= air.so2&.round(1) %></div>
                </div>
              </div>
              <% if air.recorded_at.present? %>
                <div class="mt-2">
                  <small class="text-muted">
                    <i class="bi bi-clock-history"></i>
                    Updated <%= time_ago_in_words(air.recorded_at) %> ago
                  </small>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
<% else %>
  <div class="alert alert-info mb-0">
    <i class="bi bi-info-circle"></i>
    <strong>No air quality data available</strong>
    <p class="mb-0 mt-2">Air quality data will appear here once synchronized.
    <%= link_to "Sync now", sync_weather_dashboards_path, method: :post, class: "alert-link" %></p>
  </div>
<% end %>
