<% chart_data = {}
   locations.each do |location|
     metrics = location.weather_metrics_24h.order(:recorded_at)
     if metrics.any?
       data_points = metrics.map do |metric|
         [metric.recorded_at.to_time, metric.temperature.to_f]
       end
       chart_data[location.name] = data_points
     end
   end
%>

<% if chart_data.present? && chart_data.values.any?(&:any?) %>
  <%= line_chart chart_data,
      xtitle: 'Time',
      ytitle: 'Temperature (°C)',
      curve: true,
      points: true,
      download: false,
      library: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: {
            type: 'time',
            time: {
              unit: 'hour',
              displayFormats: {
                hour: 'HH:mm'
              }
            },
            title: {
              display: true,
              text: 'Time'
            }
          },
          y: {
            beginAtZero: false,
            title: {
              display: true,
              text: 'Temperature (°C)'
            }
          }
        },
        plugins: {
          legend: {
            display: true,
            position: 'bottom'
          }
        }
      }
  %>
<% else %>
  <div class="alert alert-info mb-0">
    <i class="bi bi-info-circle"></i> No temperature data available yet. Click "Refresh Now" to fetch weather data.
  </div>
<% end %>