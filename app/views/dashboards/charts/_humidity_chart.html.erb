<% chart_data = {}
   locations.each do |location|
     metrics = location.weather_metrics.where("recorded_at > ?", 24.hours.ago).order(:recorded_at)
     if metrics.any?
       data_points = metrics.map do |metric|
         [metric.recorded_at.strftime('%H:%M'), metric.humidity.to_i]
       end.to_h
       chart_data[location.name] = data_points
     end
   end
%>

<% if chart_data.present? && chart_data.values.any?(&:any?) %>
  <%= line_chart chart_data,
      xtitle: 'Time',
      ytitle: 'Humidity (%)',
      min: 0,
      max: 100,
      points: true,
      download: true,
      library: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: true,
            position: 'bottom'
          }
        },
        scales: {
          y: {
            min: 0,
            max: 100,
            title: {
              display: true,
              text: 'Humidity (%)'
            }
          },
          x: {
            title: {
              display: true,
              text: 'Time'
            }
          }
        }
      }
  %>
<% else %>
  <div class="alert alert-info mb-0">
    <i class="bi bi-info-circle"></i> No humidity data available yet. Click "Refresh Now" to fetch weather data.
  </div>
<% end %>